function setStartScrollListener(){function e(e){if(!(window.pageYOffset>=window.innerHeight||app.zonesVisible)){if(e.preventDefault(),(n.mobileDisplay>=1||1==n.display)&&e.deltaY<0&&!app.zonesVisible)return n.scrollToTop(function(){setTimeout(function(){window.removeEventListener("wheel",t),window.removeEventListener("touchmove",t)},750)}),n.mobileDisplay=0,n.display=0,window.addEventListener("wheel",t,{passive:!1}),void window.addEventListener("touchmove",t,{passive:!1});(1!=n.mobileDisplay||1!=n.display)&&e.deltaY>0&&!app.zonesVisible&&(n.scrollToInfo(function(){setTimeout(function(){window.removeEventListener("wheel",t),window.removeEventListener("touchmove",t)},750)}),window.addEventListener("wheel",t,{passive:!1}),window.addEventListener("touchmove",t,{passive:!1}),n.mobileDisplay=1,n.display=1)}}function t(e){e.preventDefault()}var n=this;window.innerWidth<768||(window.addEventListener("wheel",e,{passive:!1}),window.addEventListener("touchmove",e,{passive:!1}))}function calcAnimation(e,t){var n,i=document.querySelector(".city-graphics__image_city"),o=document.querySelectorAll(".city-graphics__svg-mask"),s=document.querySelectorAll(".city-graphics__images"),r=document.querySelector("#city_last"),l=i.offsetWidth,a=getSizesFromMasks(o,l),c=Object.keys(a),d=!1,h=0,u=getGap(),f=(h=getShift(a[e],u),(a[e].leftSide?1:-1)*(a[e].width-.1*l)/2);setLoader({timeline:t,size:a[e],gap:u,translateImage:f});for(var m=0,p=c.length;m<p;m++)n=a[c[m]],n.leftSide?(c[m]==e&&(d=!0),n.shift=d?h.right:h.left):(n.shift=d?h.right:h.left,c[m]==e&&(d=!0)),t.add({targets:n.elem,translateX:n.shift},0);t.add({targets:r,translateX:a[c[0]].shift},0),window.innerWidth>=768&&t.add({targets:s,translateX:f,scale:1.1},0)}function getGap(){var e=.25,t=window.innerWidth;return t<768?e=1.5:t<1200&&(e=.6),window.innerWidth*e}function setLoader(e){var t=document.querySelector(".city-graphics__loader"),n=getLeft(t,e);if(t.innerHTML="",0==t.innerHTML.length){var i=addAnim({container:t,name:"loader"});i.play()}e.timeline.add({targets:t,duration:350,left:[n,n],scale:[.6,1],opacity:[0,1]},350)}function getLeft(e,t){var n=0,i=document.querySelector(".city__inner"),o=getMultiplier(),s=t.gap*o;return n=t.size.leftSide?t.size.left+t.size.width+s/2-e.offsetWidth/2:t.size.left-s/2-e.offsetWidth/2,n+i.scrollLeft}function getMultiplier(){var e=window.innerWidth,t=1;return e<768?t=3:e<1024?t=1.616:e<1200&&(t=1.212),window.innerWidth/3e3*t}function getShift(e,t){return{left:e.leftSide?t:0,right:e.leftSide?0:-t}}function getSizesFromMasks(e,t){var n,i,o={};window.innerWidth<992&&(o.last={elem:document.querySelector("#city_last")});for(var s=0,r=e.length;s<r;s++)n=e[s].closest(".city-graphics__svg"),i=n.getAttribute("data-name"),o[i]=getBuildingInfo(e[s],t),o[i].elem=n;return o}function getBuildingInfo(e,t){var n=e.getBoundingClientRect(),i=n.left;return width=n.width,{width:width,left:i,leftSide:i-t/2+width/2<=0}}function setZonesScroll(e){setZoneSizes();var t=document.querySelector(".zones__inner"),n=t.querySelector(".zone[data-name='"+e+"']");t.scrollLeft=n.offsetLeft}function setZoneSizes(){for(var e,t=document.querySelectorAll(".zones__zone"),n=0,i=t.length;n<i;n++)zone=t[n],e=zone.querySelector(".zone-image__image"),zone.style.width=e.offsetWidth+"px"}function revertBuilding(){for(var e=document.querySelector(".city-graphics__images"),t=e.querySelectorAll(".city-graphics__svg"),n=document.querySelector(".city-graphics__loader"),i=0,o=t.length;i<o;i++)t[i].style.transform="translate(0px,0px)";e.style.transform="",n.innerHTML="",n.style="",lottie.stop()}function showZones(e){var t=document.querySelector(".zones"),n=t.querySelector(".zones__inner"),i="zones__inner_visible",o=document.querySelector(".city__inner").scrollLeft;anime({targets:n,translateX:[window.innerWidth,0],duration:350,delay:350,easing:"easeInOutSine",complete:function(){var t=this.animatables[0].target;t.classList.add(i),app.activeZone=app.getZoneByName(e),revertBuilding()}}),anime({targets:t,opacity:[0,1],left:[o,o],duration:350,delay:350,easing:"easeInOutSine"})}function hideZones(){var e=document.querySelector(".zones"),t=e.querySelector(".zones__inner"),n="zones__inner_visible";anime({targets:t,translateX:[0,window.innerWidth],duration:350,easing:"easeInOutSine",complete:function(){var e=this.animatables[0].target;e.classList.remove(n),app.activeZone=null}}),anime({targets:e,opacity:[1,0],duration:350,easing:"easeInOutSine",complete:function(){app.zonesVisible=!1,this.animatables[0].target.style="",showFooterElem()}})}function setZoneScrollListener(){function e(){y.centeringShift=n(),y.coords=t(),data.drawCoords&&u(y.coords)}function t(){for(var e,t,n,s,r,l=[],a=0,c=w.length;a<c;a++){e=w[a].offsetLeft,r=w[a].classList.contains("zone")?w[a].querySelector(".zone-image__image").offsetWidth:w[a].offsetWidth,t=i(w[a],r),s=+w[a].getAttribute("data-length"),n=t/s,shiftLeft=o(w[a],r);for(var d=0,h=s;d<h;d++)l.push({zone:a,tech:d,width:n+(0==d?shiftLeft:0),left:n*d+e+(d>0?shiftLeft:0)});s||l.push({zone:a,tech:0,width:r,left:e})}return l}function n(){return window.innerWidth<992?window.innerWidth/2:v.querySelector(".zone__col-content").offsetLeft/2}function i(e,t){var n={city:window.innerWidth<768?.21:.245,education:.12,health:.155,home:.18,office:.18,retail:.22};return t-t*n[e.getAttribute("data-name")]}function o(e,t){var n={city:.01,education:.01,health:0,home:.035,office:0,retail:0};return t*n[e.getAttribute("data-name")]}function s(){g.scrollTimestamp=(new Date).getTime(),z.scrollTimestamp=(new Date).getTime(),-1==g.id&&(g.id=window.requestAnimationFrame(c)),data.stackZones&&-1==z.id&&(z.id=window.requestAnimationFrame(r))}function r(){var e,t=(new Date).getTime(),n=d();if(z.scrollTimestamp+z.delay<t)return window.cancelAnimationFrame(z.id),void(z.id=-1);if(n.zone!=_||!_)for(var i=0,o=w.length;i<o;i++)l(w[i],0);0!=n.zone?(n.zone!=_&&(S=a(n.zone-1),_=n.zone,L=S.offsetLeft,T=S.offsetWidth),e=v.scrollLeft+window.innerWidth-(L+T),e>window.innerWidth?z.id=window.requestAnimationFrame(r):(z.id=window.requestAnimationFrame(r),l(S,e))):z.id=window.requestAnimationFrame(r)}function l(e,t){var n=e.querySelector(".zone__container"),i="zone__container_absolute";if(n){if(e.style.transform="translateX("+t+"px)",0==t)return e.style.opacity=1,void(n.classList.contains(i)&&n.classList.remove(i));t&&!n.classList.contains(i)&&n.classList.add(i),e.style.opacity=1-t/window.innerWidth}}function a(e){return w[e]}function c(){var e=(new Date).getTime();if(g.scrollTimestamp+g.delay<e)return window.cancelAnimationFrame(g.id),void(g.id=-1);changeElemOnScroll?g.lastUpdate+g.updateDelay>e?g.id=window.requestAnimationFrame(c):(m=h(),p||(p={}),m.zone==p.zone&&m.tech==p.tech||(p.zone=m.zone,p.tech=m.tech,f({zone:m.zone,tech:m.tech})),g.id=window.requestAnimationFrame(c),g.lastUpdate=(new Date).getTime()):g.id=window.requestAnimationFrame(c)}function d(){var e=v.scrollLeft,t=y.coords[0],n=t;e+=window.innerWidth;for(var i=0,o=y.coords.length;i<o;i++)if(t=0==y.coords[i].tech?y.coords[i]:t,0==t.tech){if(y.coords[i].left>e){t=n;break}n=t}return t}function h(){var e,t=v.scrollLeft;t+=y.centeringShift;for(var n=0,i=y.coords.length;n<i&&(e=y.coords[n],y.coords[n+1])&&!(y.coords[n+1].left>t);n++);return{zone:+e.zone,tech:+e.tech}}function u(e){for(var t,n=document.querySelectorAll(".draw-coords"),i=0,o=n.length;i<o;i++)n[i].parentNode.removeChild(n[i]);for(i=0,o=e.length;i<o;i++)t=document.createElement("div"),t.style.left=e[i].left+"px",t.style.position="absolute",t.style.width=e[i].width+"px",t.style.height=window.innerHeight/2+"px",t.style.zIndex=10,t.style.top="50%",t.className="draw-coords",t.style.border="3px solid #fff",t.style.marginTop=-window.innerHeight/4+"px",t.style.backgroundColor="rgba(255,0,0,.3)",v.appendChild(t)}function f(e){app.setZoneByScroll(e.zone),app.setTechByScroll(e.tech)}var m,p,v=document.querySelector(".zones__inner"),w=document.querySelectorAll(window.innerWidth<768?".zone,.zones__footer":".zone"),y=scrollOptions,g={id:-1,scrollTimestamp:null,delay:100,updateDelay:100,lastUpdate:0},z={id:-1,scrollTimestamp:null,delay:100,lastUpdate:0},S=w[0],_=0,L=S.offsetLeft,T=S.offsetWidth;window.calcZones=e,window.addEventListener("load",function(){setTimeout(function(){e(),v.addEventListener("scroll",s)},1e3)}),window.addEventListener("resize",e)}function scrollZonesInner(e,t,n){function i(e,t){for(var n=scrollOptions.coords,i=0,o=n.length;i<o;i++)if(n[i].zone==e&&n[i].tech==t)return n[i];return null}function o(){var o=i(e+1,0);if(o&&(scrollNextCoord=o.left-window.innerWidth),n&&0==t)return r.left;var s=r.left-scrollOptions.centeringShift+r.width/2;return n&&t>0&&o?o&&s>scrollNextCoord?scrollNextCoord:s:(o&&s>scrollNextCoord&&(s=scrollNextCoord),0==r.tech&&s<r.left&&(s=r.left),s)}var s=document.querySelector(".zones__inner"),r=-1!=e?i(e,t):null;changeElemOnScroll=!1,disableScrollPointer(),anime({targets:s,scrollLeft:r?o(r):0,duration:350,easing:"easeInOutSine",complete:function(){changeElemOnScroll=!0,enableScrollPointer()}})}function scrollInfoToTop(e){for(var t=e.querySelectorAll(".zone-info__item"),n=0,i=t.length;n<i;n++)t[n].scrollTop=0}function generateShare(){var e,t,n,i,o,s,r;return n="https://connect.ok.ru/offer?url={{url}}?&imageUrl={{imageUrl}}",i="https://vk.com/share.php?url={{url}}",e="http://twitter.com/share?text={{text}}&url={{url}}",t="https://www.facebook.com/sharer/sharer.php?u={{url}}",s=data.okImage,r=data.twitterText,o=data.url,{tw:e.replace("{{url}}",o).replace("{{text}}",r),fb:t.replace("{{url}}",o),ok:n.replace("{{url}}",o).replace("{{imageUrl}}",s),vk:i.replace("{{url}}",o)}}var scrollPointerDisabled=!1,changeElemOnScroll=!0,scrollOptions={};Vue.component("zone",{template:document.getElementById("zoneTemplate").innerHTML,props:["data","transition","index","slide-index"],data:function(){return{slide:0,activeTech:{},lineTranslate:0,imageTranslate:0,zone:data.zones[0],zoneInfoExpanded:!1}},computed:{techLength:function(){return this.zone.tech.length},itemsWidth:function(){return 100*this.techLength},itemWidth:function(){return 100/this.techLength},itemsTranslate:function(){return-100/this.techLength*this.slide}},methods:{nextSlide:function(){this.slide>=this.zone.tech.length-1?app.scrollToNextZone():this.setSlide(this.slide+1)},prevSlide:function(){this.slide<=0?app.scrollToPrevZone():this.setSlide(this.slide-1)},setSlide:function(e,t){e=e<=0?0:e,e=e>=this.techLength?this.techLength-1:e,isNaN(e)||(this.slide=e,this.setActiveTech(),t||scrollZonesInner(this.index,this.slide))},setActiveTech:function(e){this.activeTech=this.zone.tech[void 0===e?this.slide:e]},getTechByIndex:function(e){return this.zone.tech(e)||null},setSlideFromHash:function(){var e=+window.location.hash.slice(1);isNaN(e)||0==e||this.setSlide(e-1)},updateImagePosition:function(){var e=this.$el.querySelector(".zone-image__image"),t=e.offsetWidth,n=window.innerWidth,i=t-n;this.imageTranslate=-i*(1/(this.techLength-1)*this.slide)},updateLinePosition:function(){var e=this.$el.querySelectorAll(".zone-pag__item")[this.slide];this.lineTranslate=e.offsetLeft},copyData:function(e){e&&(this.zone=this.data)},toCity:hideZones},watch:{zoneInfoExpanded:function(e){e||scrollInfoToTop(this.$el)},slideIndex:function(e){this.setSlide(e,!0)},slide:function(e){this.updateLinePosition(),scrollInfoToTop(this.$el)},data:function(e){this.copyData(e)},zone:function(){this.setSlide(0,!0)}},beforeMount:function(){this.copyData(this.data),window.addEventListener("load",this.updateLinePosition)},mounted:function(){this.zone&&(this.updateLinePosition(),this.setSlide(this.slideIndex,!0),this.$el.querySelector(".zone-image__image").addEventListener("load",this.updateImagePosition))}});var mustShowSwipe=!0,app=new Vue({el:document.querySelector("#app"),data:{needUpdateByLocation:!1,menu_visible:!1,zones:data.zones,cityButtonHidden:!0,activeZone:null,zonesVisible:!1,hoveredCityName:null,techIndex:null,cityInView:!1,mobileDisplay:0,display:0,mustOpen:{timestamp:null,zone:null,requestId:-1,delay:350,animationTimeline:null},share:generateShare()},computed:{zonesReversed:function(){var e=this.zones.slice().reverse();return e}},methods:{getSlideIndex:function(e){return this.activeZone?e.name==this.activeZone.name?this.techIndex:this.prevZone&&e.name==this.prevZone.name?e.tech.length-1:0:0},setZoneByScroll:function(e){this.activeZone=this.zones[e]},setTechByScroll:function(e){this.setSlide(e)},cityButtonClick:function(){this.closeMenu(),scrollToCity()},closeMenu:function(e){var t=this;e?setTimeout(function(){t.menu_visible=!1},e):this.menu_visible=!1},cityOver:function(e){this.hoveredCityName=e},cityOut:function(e){this.hoveredCityName==e&&(this.hoveredCityName=null)},toggleMenu:function(){this.menu_visible=!this.menu_visible},getZoneByName:function(e){for(var t=0,n=this.zones.length;t<n;t++)if(this.zones[t].name==e)return this.zones[t];return null},getPrevZone:function(){if(this.activeZone){for(var e=this.activeZone.name,t=1,n=this.zones.length;t<n;t++)if(this.zones[t].name==e)return this.zones[t-1];return null}},setZoneByName:function(e){var t=document.querySelector(".zones .zones__inner"),n="zones__inner_visible",i=e?this.getZoneByName(e):null;setZonesScroll(e),t.classList.add(n),this.zonesVisible=!0,this.activeZone=i,this.display=1,this.mobileDisplay=1,hideTopElem(),hideFooterElem(),this.closeMenu()},moveCityIndicator:function(e){if(e){var t=this.$el.querySelector(".city-menu__link[href='"+e.path+"']"),n=this.$el.querySelector(".city__header-line"),i=t.offsetLeft+t.offsetWidth/2;n.style.transform="translateX("+i+"px) translateZ(0)"}},cityClick:function(e){var t=this.getZoneByName(e);this.mustOpen.zone=t,this.moveCityIndicator(t),hideTopElem(),this.display=1,hideFooterElem()},scrollToInfo:function(e){scrollToInfo(e)},scrollToTop:function(e){scrollToTop(e)},scrollToCity:function(){scrollToCity()},scrollToNextZone:function(){var e=this.activeZone.index,t=this.zones[e+1];t&&scrollZonesInner(e+1,0,!0)},scrollToPrevZone:function(){var e,t=this.activeZone.index,n=this.zones[t-1];n?(e=n.tech.length,scrollZonesInner(t-1,e-1,!0)):scrollZonesInner(-1)},setSlide:function(e){this.activeZone&&this.techIndex!=e&&(this.techIndex=e)},checkLink:function(e){var t,n,i=location.pathname.replace(/[/]/g,""),o=i==data.cityPath?-1:+i;o&&"number"==typeof o&&!isNaN(o)&&(t=this.zones[o-1],t?(n=t.name,n&&e&&e(n)):this.mobileDisplay=2)},toCity:hideZones},watch:{zonesVisible:function(e){if(!e)return showTopElem(),void lottie.play();this.mobileDisplay=2,window.calcZones()},mobileDisplay:function(e){var t="swipe-device_visible";if(!(e<2)&&mustShowSwipe){var n=document.querySelector(".swipe-device");mustShowSwipe=!1,setTimeout(function(){n.classList.add(t),setTimeout(function(){n.classList.remove(t)},1500)},1e3)}},activeZone:function(e){this.mustOpen.zone=null,this.techIndex=0,path=e?e.path:data.cityPath,this.activeZone&&this.prevZone==this.activeZone&&(this.techIndex=this.prevZone.length-1),this.prevZone=this.getPrevZone(),window.location.pathname.replace(/[/]/g,"")!=path&&replacePath(path)},"mustOpen.zone":function(e){e&&(setZonesScroll(e.name),this.zonesVisible=!0,this.mustOpen.timeline=anime.timeline({easing:"easeInOutSine",duration:350,autoplay:!1,complete:function(){showZones(e.name)}}),calcAnimation(e.name,this.mustOpen.timeline),setTimeout(this.mustOpen.timeline.play,this.mustOpen.delay))}},mounted:function(){var e=this;this.moveCityIndicator(this.activeZone),setZoneScrollListener(),document.body.style.opacity=1,window.addEventListener("load",function(){e.checkLink(function(t){e.setZoneByName(t),lottie.stop()}),setStartScrollListener.bind(e)()})}});"scrollRestoration"in history&&(history.scrollRestoration="manual");